tests= $(shell find . -type f -name '*.c')
tests+= ../util/util.c 
#tests+= $(shell find ../mpfss_batch_codes -type f -name '*.c')

#tests_h= $(shell find . -type f -name '*.h')
#tests_h+= $(shell find ../mpfss_batch_codes/ -type f -name '*.h')


OBLIVCC=../../obliv-c/bin/oblivcc
RUNTIME=../../obliv-c/_build/libobliv.a


#DNDEBUG sets the debug level. 
CFLAGS=-g -Wall -D _Float128=double -DTESTING #-DDEBUG

ACKLIB_FFSL=../../absentminded-crypto-kit/src/oram_fssl/
Mpfss_path=../mpfss/
Mpfss_bc_src_path=../mpfss_batch_codes/src
Mpfss_bc_includes_path=../mpfss_batch_codes/include
OBLIVCH = ../../obliv-c/src/ext/oblivc
Util_path=../util/
INCLUDE=-I$(ACKLIB_FFSL) -I$(Mpfss_path)  -I$(Mpfss_bc_src_path) -I$(Mpfss_bc_includes_path) -I$(Util_path) -I. -I $(OBLIVCH)



ACKLIB_PATH=../../absentminded-crypto-kit/build/lib/liback.a 
#-lgomp flag is very important. Otherwise linking will fail. Does some kind of parallelization.
LOADLIBES=-fopenmp $(ACKLIB_PATH) 

all: a.out

./a.out: $(tests) $(RUNTIME) # $(tests_h)
	$(OBLIVCC) $(CFLAGS) $(INCLUDE) $(tests) $(LOADFILES) $(LOADLIBES) 



